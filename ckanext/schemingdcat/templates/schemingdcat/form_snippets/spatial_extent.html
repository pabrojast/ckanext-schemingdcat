{% set field_name = field.field_name %}
{% set field_value = data.get(field_name, '') %}

<div class="spatial-extent-field">
  <textarea 
    id="{{ field_name }}" 
    name="{{ field_name }}" 
    class="form-control spatial-extent-input"
    placeholder="{{ field.form_placeholder or '' }}"
    rows="3"
    readonly>{{ field_value }}</textarea>
  
  <div class="spatial-extent-info">
    <small class="text-muted">
      <i class="fa fa-info-circle"></i>
      {{ _('This field is automatically populated when uploading spatial data files (SHP, TIF, etc.)') }}
    </small>
  </div>
  
  {% if field_value %}
  <div class="spatial-extent-preview">
    <button type="button" class="btn btn-sm btn-info preview-extent" data-extent="{{ field_value }}">
      <i class="fa fa-map"></i> {{ _('Preview Extent') }}
    </button>
  </div>
  {% endif %}
</div>

<style>
.spatial-extent-field {
  margin-bottom: 15px;
}

.spatial-extent-input {
  font-family: monospace;
  font-size: 12px;
  background-color: #f8f9fa;
  border: 1px solid #dee2e6;
}

.spatial-extent-info {
  margin-top: 5px;
}

.spatial-extent-preview {
  margin-top: 10px;
}

.preview-extent {
  transition: all 0.3s ease;
}

.preview-extent:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}
</style>

<script>
(function() {
  // Add event listener for preview button
  document.addEventListener('click', function(e) {
    if (e.target.classList.contains('preview-extent') || e.target.closest('.preview-extent')) {
      var button = e.target.classList.contains('preview-extent') ? e.target : e.target.closest('.preview-extent');
      var extent = button.getAttribute('data-extent');
      
      if (extent) {
        try {
          var geom = JSON.parse(extent);
          // Simple preview - you could integrate with a map library here
          alert('Extent preview:\n' + JSON.stringify(geom, null, 2));
        } catch (e) {
          console.error('Invalid extent format:', e);
        }
      }
    }
  });
})();
</script>
